<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì˜ë‹¨ì–´ ì¶”ì¶œê¸°</title>
  <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', -apple-system, sans-serif;
      background: #f0f4f8;
      color: #1a202c;
      min-height: 100vh;
    }

    header {
      background: #2d3748;
      color: white;
      padding: 20px 32px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    header h1 { font-size: 1.4rem; font-weight: 600; }
    header span { font-size: 1.6rem; }

    .container { max-width: 960px; margin: 0 auto; padding: 28px 20px; }

    /* API Key */
    .api-section {
      background: white;
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .api-section label { font-weight: 600; white-space: nowrap; font-size: 0.9rem; }
    .api-section input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: monospace;
    }
    .api-section input:focus { outline: none; border-color: #667eea; }
    .btn-save-key {
      padding: 10px 18px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      white-space: nowrap;
    }
    .btn-save-key:hover { background: #5a67d8; }

    /* Upload Area */
    .upload-section {
      background: white;
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .upload-section h2 { font-size: 1rem; font-weight: 600; margin-bottom: 14px; color: #4a5568; }

    .drop-zone {
      border: 2px dashed #cbd5e0;
      border-radius: 10px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #f7fafc;
    }
    .drop-zone:hover, .drop-zone.drag-over {
      border-color: #667eea;
      background: #ebf4ff;
    }
    .drop-zone .icon { font-size: 2.5rem; margin-bottom: 10px; }
    .drop-zone p { color: #718096; font-size: 0.95rem; margin-bottom: 6px; }
    .drop-zone small { color: #a0aec0; font-size: 0.82rem; }
    .drop-zone input[type="file"] { display: none; }

    .btn-upload {
      display: inline-block;
      margin-top: 14px;
      padding: 10px 24px;
      background: #48bb78;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .btn-upload:hover { background: #38a169; }

    /* Preview */
    .preview-container {
      margin-top: 16px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .preview-item {
      position: relative;
      width: 90px; height: 90px;
    }
    .preview-item img {
      width: 100%; height: 100%;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
    }
    .preview-item .remove-img {
      position: absolute; top: -6px; right: -6px;
      width: 20px; height: 20px;
      background: #fc8181; color: white;
      border-radius: 50%; border: none;
      cursor: pointer; font-size: 12px; font-weight: bold;
      display: flex; align-items: center; justify-content: center;
    }

    .btn-extract {
      width: 100%;
      margin-top: 16px;
      padding: 14px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-extract:hover { background: #5a67d8; }
    .btn-extract:disabled { background: #a0aec0; cursor: not-allowed; }

    /* Loading */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #667eea;
      font-weight: 600;
    }
    .loading.show { display: block; }
    .spinner {
      display: inline-block;
      width: 28px; height: 28px;
      border: 3px solid #e2e8f0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Word Table */
    .words-section {
      background: white;
      border-radius: 12px;
      padding: 20px 24px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .words-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .words-header h2 { font-size: 1rem; font-weight: 600; color: #4a5568; }
    .word-count {
      background: #ebf4ff;
      color: #667eea;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .words-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }
    .words-table th {
      background: #f7fafc;
      padding: 10px 14px;
      text-align: left;
      font-weight: 600;
      color: #4a5568;
      border-bottom: 2px solid #e2e8f0;
    }
    .words-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #f0f4f8;
      vertical-align: middle;
    }
    .words-table tr:hover td { background: #f7fafc; }
    .words-table td input {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid transparent;
      border-radius: 6px;
      font-size: 0.95rem;
      background: transparent;
    }
    .words-table td input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
    }
    .btn-delete-row {
      padding: 4px 10px;
      background: #fff5f5;
      color: #fc8181;
      border: 1px solid #fed7d7;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    .btn-delete-row:hover { background: #fc8181; color: white; }

    .btn-add-row {
      margin-top: 12px;
      padding: 8px 18px;
      background: #f0fff4;
      color: #48bb78;
      border: 1px dashed #68d391;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.88rem;
      font-weight: 600;
    }
    .btn-add-row:hover { background: #48bb78; color: white; border-style: solid; }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #a0aec0;
    }
    .empty-state .icon { font-size: 2.5rem; margin-bottom: 10px; }

    /* Actions */
    .action-bar {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .btn-download {
      flex: 1;
      padding: 14px;
      background: #2d3748;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-download:hover { background: #1a202c; }
    .btn-download:disabled { background: #a0aec0; cursor: not-allowed; }
    .btn-clear {
      padding: 14px 20px;
      background: #fff5f5;
      color: #fc8181;
      border: 1px solid #fed7d7;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-clear:hover { background: #fc8181; color: white; }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px; right: 24px;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(80px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 999;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: #48bb78; color: white; }
    .toast.error { background: #fc8181; color: white; }
    .toast.info { background: #667eea; color: white; }
  </style>
</head>
<body>

<header>
  <span>ğŸ“š</span>
  <h1>ì˜ë‹¨ì–´ ì¶”ì¶œê¸°</h1>
</header>

<div class="container">

  <!-- API Key -->
  <div class="api-section">
    <label>ğŸ”‘ OpenAI API Key</label>
    <input type="password" id="apiKey" placeholder="sk-..." autocomplete="off">
    <button class="btn-save-key" onclick="saveApiKey()">ì €ì¥</button>
  </div>

  <!-- Upload -->
  <div class="upload-section">
    <h2>ğŸ“· ì‚¬ì§„ ì—…ë¡œë“œ</h2>
    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
      <div class="icon">ğŸ–¼ï¸</div>
      <p>í´ë¦­í•˜ê±°ë‚˜ ì‚¬ì§„ì„ ë“œë˜ê·¸í•´ì„œ ì—…ë¡œë“œ</p>
      <small>JPG, PNG, WEBP ì§€ì› Â· ì—¬ëŸ¬ ì¥ ë™ì‹œ ì—…ë¡œë“œ ê°€ëŠ¥</small>
      <input type="file" id="fileInput" accept="image/*" multiple onchange="handleFiles(this.files)">
    </div>
    <div class="preview-container" id="previewContainer"></div>
    <button class="btn-extract" id="btnExtract" onclick="extractAll()" disabled>
      ğŸ” ë‹¨ì–´ ì¶”ì¶œí•˜ê¸°
    </button>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p id="loadingText">AIê°€ ë‹¨ì–´ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...</p>
  </div>

  <!-- Word Table -->
  <div class="words-section">
    <div class="words-header">
      <h2>ğŸ“ ì¶”ì¶œëœ ë‹¨ì–´ ëª©ë¡</h2>
      <span class="word-count" id="wordCount">0 ë‹¨ì–´</span>
    </div>

    <div id="emptyState" class="empty-state">
      <div class="icon">ğŸ“–</div>
      <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ë‹¨ì–´ë¥¼ ì¶”ì¶œí•´ë³´ì„¸ìš”</p>
    </div>

    <table class="words-table" id="wordTable" style="display:none">
      <thead>
        <tr>
          <th style="width:40px">#</th>
          <th>ì˜ì–´ ë‹¨ì–´</th>
          <th>í•œê¸€ ëœ»</th>
          <th style="width:70px">ì‚­ì œ</th>
        </tr>
      </thead>
      <tbody id="wordTableBody"></tbody>
    </table>

    <button class="btn-add-row" onclick="addRow()" id="btnAddRow" style="display:none">
      + ë‹¨ì–´ ì§ì ‘ ì¶”ê°€
    </button>

    <div class="action-bar" id="actionBar" style="display:none">
      <button class="btn-download" onclick="downloadWord()">
        ğŸ“„ Word íŒŒì¼ ë‹¤ìš´ë¡œë“œ (.docx)
      </button>
      <button class="btn-clear" onclick="clearAll()">ì „ì²´ ì‚­ì œ</button>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
  // â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let pendingFiles = [];   // File objects waiting to be processed
  let words = [];          // { english, korean }

  // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const savedKey = localStorage.getItem('openai_api_key');
  if (savedKey) document.getElementById('apiKey').value = savedKey;

  // â”€â”€â”€ API Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveApiKey() {
    const key = document.getElementById('apiKey').value.trim();
    if (!key.startsWith('sk-')) {
      showToast('ì˜¬ë°”ë¥¸ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (sk-...)', 'error'); return;
    }
    localStorage.setItem('openai_api_key', key);
    showToast('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
  }

  function getApiKey() {
    return document.getElementById('apiKey').value.trim();
  }

  // â”€â”€â”€ Drag & Drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const dropZone = document.getElementById('dropZone');

  dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
  });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    handleFiles(e.dataTransfer.files);
  });

  // â”€â”€â”€ File Handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function handleFiles(files) {
    for (const file of files) {
      if (!file.type.startsWith('image/')) continue;
      pendingFiles.push(file);
      addPreview(file, pendingFiles.length - 1);
    }
    updateExtractButton();
  }

  function addPreview(file, idx) {
    const container = document.getElementById('previewContainer');
    const reader = new FileReader();
    reader.onload = e => {
      const div = document.createElement('div');
      div.className = 'preview-item';
      div.dataset.idx = idx;
      div.innerHTML = `
        <img src="${e.target.result}" alt="preview">
        <button class="remove-img" onclick="removePreview(${idx})">Ã—</button>
      `;
      container.appendChild(div);
    };
    reader.readAsDataURL(file);
  }

  function removePreview(idx) {
    pendingFiles[idx] = null;
    const el = document.querySelector(`.preview-item[data-idx="${idx}"]`);
    if (el) el.remove();
    updateExtractButton();
  }

  function updateExtractButton() {
    const hasFiles = pendingFiles.some(f => f !== null);
    document.getElementById('btnExtract').disabled = !hasFiles;
  }

  // â”€â”€â”€ Extract â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function extractAll() {
    const apiKey = getApiKey();
    if (!apiKey) {
      showToast('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”', 'error'); return;
    }
    if (!apiKey.startsWith('sk-')) {
      showToast('ì˜¬ë°”ë¥¸ OpenAI API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error'); return;
    }

    const files = pendingFiles.filter(f => f !== null);
    if (files.length === 0) return;

    setLoading(true);
    document.getElementById('btnExtract').disabled = true;

    let newWords = [];
    for (let i = 0; i < files.length; i++) {
      document.getElementById('loadingText').textContent =
        `${i + 1} / ${files.length} ë²ˆì§¸ ì‚¬ì§„ ë¶„ì„ ì¤‘...`;
      try {
        const extracted = await extractFromFile(files[i], apiKey);
        newWords = newWords.concat(extracted);
      } catch (err) {
        console.error(err);
        showToast(`ì˜¤ë¥˜: ${err.message}`, 'error');
      }
    }

    words = words.concat(newWords);
    pendingFiles = [];
    document.getElementById('previewContainer').innerHTML = '';

    setLoading(false);
    renderTable();
    showToast(`${newWords.length}ê°œ ë‹¨ì–´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
  }

  async function extractFromFile(file, apiKey) {
    const base64 = await fileToBase64(file);
    const mimeType = file.type || 'image/jpeg';

    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: 'gpt-4o',
        messages: [{
          role: 'user',
          content: [
            {
              type: 'text',
              text: `ì´ ì´ë¯¸ì§€ì—ì„œ ì˜ì–´ ë‹¨ì–´ì™€ í•œê¸€ ëœ» ìŒì„ ëª¨ë‘ ì°¾ì•„ JSON ë°°ì—´ë¡œ ë°˜í™˜í•´ì¤˜.
í˜•ì‹: [{"english": "ë‹¨ì–´", "korean": "í•œê¸€ ëœ»"}, ...]
- ì˜ì–´ ë‹¨ì–´ì™€ í•œê¸€ ëœ»ì´ í•¨ê»˜ ìˆëŠ” í•­ëª©ë§Œ ì¶”ì¶œ
- ì¤‘ë³µ ë‹¨ì–´ëŠ” ì œê±°
- ì˜ì–´ ë‹¨ì–´ëŠ” ì†Œë¬¸ìë¡œ í†µì¼
- JSON ë°°ì—´ë§Œ ë°˜í™˜ (ë‹¤ë¥¸ ì„¤ëª… ì—†ì´)
- ë‹¨ì–´ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ [] ë°˜í™˜`
            },
            {
              type: 'image_url',
              image_url: {
                url: `data:${mimeType};base64,${base64}`,
                detail: 'high'
              }
            }
          ]
        }],
        max_tokens: 4096
      })
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.error?.message || `HTTP ${response.status}`);
    }

    const data = await response.json();
    const content = data.choices[0].message.content.trim();

    const match = content.match(/\[[\s\S]*\]/);
    if (!match) return [];

    try {
      const parsed = JSON.parse(match[0]);
      return parsed.filter(w => w.english && w.korean);
    } catch {
      return [];
    }
  }

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = e => {
        const base64 = e.target.result.split(',')[1];
        resolve(base64);
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  // â”€â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderTable() {
    const body = document.getElementById('wordTableBody');
    body.innerHTML = '';

    words.forEach((w, i) => {
      const tr = document.createElement('tr');
      tr.dataset.idx = i;
      tr.innerHTML = `
        <td style="color:#a0aec0;font-size:0.85rem;text-align:center">${i + 1}</td>
        <td><input type="text" value="${escHtml(w.english)}" onchange="words[${i}].english=this.value" placeholder="ì˜ì–´ ë‹¨ì–´"></td>
        <td><input type="text" value="${escHtml(w.korean)}" onchange="words[${i}].korean=this.value" placeholder="í•œê¸€ ëœ»"></td>
        <td><button class="btn-delete-row" onclick="deleteRow(${i})">ì‚­ì œ</button></td>
      `;
      body.appendChild(tr);
    });

    const hasWords = words.length > 0;
    document.getElementById('wordTable').style.display = hasWords ? 'table' : 'none';
    document.getElementById('emptyState').style.display = hasWords ? 'none' : 'block';
    document.getElementById('btnAddRow').style.display = hasWords ? 'inline-block' : 'none';
    document.getElementById('actionBar').style.display = hasWords ? 'flex' : 'none';
    document.getElementById('wordCount').textContent = `${words.length} ë‹¨ì–´`;
    updateExtractButton();
  }

  function deleteRow(idx) {
    words.splice(idx, 1);
    renderTable();
  }

  function addRow() {
    words.push({ english: '', korean: '' });
    renderTable();
    // Focus on the new row's first input
    const rows = document.querySelectorAll('#wordTableBody tr');
    const lastRow = rows[rows.length - 1];
    if (lastRow) lastRow.querySelector('input').focus();
  }

  function clearAll() {
    if (!confirm('ë‹¨ì–´ ëª©ë¡ì„ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?')) return;
    words = [];
    pendingFiles = [];
    document.getElementById('previewContainer').innerHTML = '';
    renderTable();
    showToast('ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
  }

  // â”€â”€â”€ Word Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function downloadWord() {
    if (words.length === 0) {
      showToast('ì €ì¥í•  ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤', 'error'); return;
    }

    try {
      const { Document, Table, TableRow, TableCell, Paragraph, TextRun,
              WidthType, AlignmentType, HeadingLevel, BorderStyle } = docx;

      const headerRow = new TableRow({
        children: [
          new TableCell({
            children: [new Paragraph({
              children: [new TextRun({ text: 'ì˜ì–´ ë‹¨ì–´', bold: true, size: 24 })],
              alignment: AlignmentType.CENTER
            })],
            shading: { fill: '2d3748', color: '2d3748' },
            width: { size: 40, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({
              children: [new TextRun({ text: 'í•œê¸€ ëœ»', bold: true, size: 24, color: 'FFFFFF' })],
              alignment: AlignmentType.CENTER
            })],
            shading: { fill: '2d3748', color: '2d3748' },
            width: { size: 60, type: WidthType.PERCENTAGE }
          })
        ],
        tableHeader: true
      });

      const dataRows = words
        .filter(w => w.english || w.korean)
        .map((w, i) => new TableRow({
          children: [
            new TableCell({
              children: [new Paragraph({
                children: [new TextRun({ text: w.english || '', size: 22 })]
              })],
              shading: { fill: i % 2 === 0 ? 'FFFFFF' : 'F7FAFC' }
            }),
            new TableCell({
              children: [new Paragraph({
                children: [new TextRun({ text: w.korean || '', size: 22 })]
              })],
              shading: { fill: i % 2 === 0 ? 'FFFFFF' : 'F7FAFC' }
            })
          ]
        }));

      const table = new Table({
        rows: [headerRow, ...dataRows],
        width: { size: 100, type: WidthType.PERCENTAGE }
      });

      const today = new Date().toLocaleDateString('ko-KR', {
        year: 'numeric', month: 'long', day: 'numeric'
      });

      const doc = new Document({
        sections: [{
          children: [
            new Paragraph({
              children: [new TextRun({ text: 'ğŸ“š ì˜ë‹¨ì–´ ë‹¨ì–´ì¥', bold: true, size: 36 })],
              heading: HeadingLevel.HEADING_1,
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({
                text: `ì¶”ì¶œ ì¼ì: ${today}  |  ì´ ${words.filter(w=>w.english||w.korean).length}ê°œ`,
                size: 18, color: '718096'
              })],
              spacing: { after: 400 }
            }),
            table
          ]
        }]
      });

      const blob = await docx.Packer.toBlob(doc);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ì˜ë‹¨ì–´ì¥_${new Date().toISOString().slice(0,10)}.docx`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Word íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤', 'success');
    } catch (err) {
      console.error(err);
      showToast('íŒŒì¼ ìƒì„± ì˜¤ë¥˜: ' + err.message, 'error');
    }
  }

  // â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setLoading(show) {
    document.getElementById('loading').classList.toggle('show', show);
    document.getElementById('btnExtract').disabled = show;
  }

  function showToast(msg, type = 'info') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = `toast ${type} show`;
    setTimeout(() => t.classList.remove('show'), 3000);
  }

  function escHtml(str) {
    return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
</script>

</body>
</html>
